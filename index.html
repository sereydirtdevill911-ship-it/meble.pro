<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Konfigurator PRO ‚Äì R2.3.1 SAFE PATCH</title>

<style>
body{font-family:Arial;background:#eef1f5;margin:0;padding:20px;}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
h1{background:#1f2d3d;color:white;padding:15px;border-radius:8px;text-align:center;}
label{font-weight:bold;}
select,input{width:100%;padding:8px;margin:6px 0 14px;border-radius:6px;border:1px solid #ccc;}
button{width:100%;padding:10px;margin-top:8px;border:none;border-radius:6px;font-weight:bold;color:white;cursor:pointer;}
.primary{background:#2f5bd3;}
.secondary{background:#666;}
.danger{background:#c0392b;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ddd;padding:6px;text-align:left;font-size:14px;}
th{background:#f0f0f0;}
.warning{color:red;font-weight:bold;}
.drawerBlock{background:#f7f7f7;padding:8px;margin-bottom:8px;border-radius:6px;}
</style>
</head>
<body>

<div class="container">
<h1>Konfigurator PRO ‚Äì R2.3.1 SAFE PATCH</h1>

<label>Typ korpusu</label>
<select id="type" onchange="autoLogic()">
<option>Dolna</option>
<option>Dolna GOLA</option>
<option>WiszƒÖca</option>
<option>Pod zmywarkƒô</option>
<option>Pod lod√≥wkƒô</option>
</select>

<label>Konstrukcja</label>
<select id="config" onchange="updateDrawerSelectors()">
<option>Drzwi</option>
<option>Szuflady</option>
</select>

<label>Ilo≈õƒá front√≥w (Drzwi)</label>
<select id="frontCount">
<option value="1">1</option>
<option value="2">2</option>
</select>

<label>System szuflad</label>
<select id="system" onchange="updateDrawerSelectors()">
<option>Antaro</option>
<option>Tandembox</option>
<option>Merivobox</option>
<option>Legrabox</option>
</select>

<label>Ilo≈õƒá szuflad</label>
<input type="number" id="qty" value="3" min="1" max="8" onchange="updateDrawerSelectors()">

<div id="drawerSelectors"></div>

<label>Wysoko≈õƒá (mm)</label>
<input type="number" id="height" value="720">

<label>Szeroko≈õƒá (mm)</label>
<input type="number" id="width" value="600">

<label>G≈Çƒôboko≈õƒá (mm)</label>
<input type="number" id="depth" value="560">

<label>Prowadnica</label>
<select id="runner">
<option>450</option>
<option selected>500</option>
<option>550</option>
</select>

<button class="primary" onclick="calculate()">Oblicz</button>
<button class="secondary" onclick="addModule()">‚ûï Dodaj modu≈Ç</button>
<button class="secondary" onclick="showProject()">üìä Poka≈º projekt</button>
<button class="danger" onclick="clearProject()">üóë Wyczy≈õƒá projekt</button>

<div id="result"></div>
<div id="projectView"></div>
</div>

<script>

const systemData={
Antaro:{types:{N:68,M:84,C:148,D:196},offset:38,minWidth:300},
Tandembox:{types:{N:68,M:84,C:148,D:196},offset:38,minWidth:300},
Merivobox:{types:{E:90,M:130,K:180,H:250},offset:42,minWidth:350},
Legrabox:{types:{N:66,M:90,C:177,F:241},offset:38,minWidth:300}
};

let project=[];

function autoLogic(){
let t=type.value;

if(t==="WiszƒÖca"||t==="Pod zmywarkƒô"||t==="Pod lod√≥wkƒô"){
config.value="Drzwi";
config.disabled=true;
}else config.disabled=false;

if(t==="WiszƒÖca"){height.value=720;depth.value=320;}
if(t==="Pod zmywarkƒô"){height.value=720;depth.value=560;}
if(t==="Pod lod√≥wkƒô"){height.value=2130;depth.value=600;}

updateDrawerSelectors();
}

function updateDrawerSelectors(){
drawerSelectors.innerHTML="";
if(config.value!=="Szuflady") return;

let sys=system.value;
for(let i=1;i<=qty.value;i++){
let div=document.createElement("div");
div.className="drawerBlock";
div.innerHTML="<strong>Szuflada "+i+"</strong><br>";
let select=document.createElement("select");
select.id="drawerType_"+i;
for(let t in systemData[sys].types){
let opt=document.createElement("option");
opt.value=t;
opt.text=t+" ("+systemData[sys].types[t]+" mm)";
select.appendChild(opt);
}
div.appendChild(select);
drawerSelectors.appendChild(div);
}
}

/* ===== SAFE FIXED CORE ===== */

function generateModuleData(cfg){

let parts=[];
let runners=[];
let light=cfg.width-36;
let golaOffset=(cfg.type==="Dolna GOLA")?50:0;

/* GLOBAL SAFETY */

if(cfg.width < 300 || cfg.width > 1200)
throw "Szeroko≈õƒá 300‚Äì1200 mm";

if(cfg.height < 300 || cfg.height > 2400)
throw "Wysoko≈õƒá 300‚Äì2400 mm";

if(light <= 0)
throw "Za ma≈Ça szeroko≈õƒá ≈õwiat≈Ça";

if(cfg.config==="Szuflady"){
if(cfg.qty < 1 || cfg.qty > 8)
throw "Ilo≈õƒá szuflad 1‚Äì8";
}

/* –∫–æ—Ä–ø—É—Å */

parts.push({name:"Bok",w:cfg.height,h:cfg.depth,t:18});
parts.push({name:"Bok",w:cfg.height,h:cfg.depth,t:18});

if(cfg.type!=="Pod zmywarkƒô"){
parts.push({name:"Dno",w:light,h:cfg.depth,t:18});
}

if(cfg.type==="Pod lod√≥wkƒô"){
let wneka=cfg.height-(2*18)-4;
parts.push({name:"Wnƒôka",w:light,h:wneka,t:0});
}else{
parts.push({name:"Wieniec",w:light,h:cfg.depth,t:18});
}

parts.push({name:"Plecy",w:cfg.width-2,h:cfg.height-2,t:3});

/* DRZWI */

if(cfg.config==="Drzwi"){

let fh=cfg.height-4-golaOffset;

if(cfg.frontCount==2){

let luz=2;
let fw=Math.floor((cfg.width-4-luz)/2);
let second=(cfg.width-4-luz)-fw;

parts.push({name:"Front",w:fw,h:fh,t:18});
parts.push({name:"Front",w:second,h:fh,t:18});

}else{
parts.push({name:"Front",w:cfg.width-4,h:fh,t:18});
}
}

/* SZUFLADY */

if(cfg.config==="Szuflady"){

if(cfg.width < systemData[cfg.system].minWidth)
throw "Szeroko≈õƒá za ma≈Ça dla wybranego systemu";

if(cfg.depth < cfg.runner + 10)
throw "Za ma≈Ça g≈Çƒôboko≈õƒá pod prowadnicƒô";

if(cfg.height > 1500 && cfg.qty > 5)
throw "Max 5 szuflad dla wysokiego korpusu";

let availableHeight=cfg.height-golaOffset-((cfg.qty+1)*3);
let frontH=Math.floor(availableHeight/cfg.qty)-4;

if(frontH>400)
throw "Front za wysoki (max 400 mm)";

for(let i=0;i<cfg.qty;i++){

let backH=systemData[cfg.system].types[cfg.drawerTypes[i]];

if(frontH < backH+20)
throw "Front za niski dla typu szuflady";

let internal=frontH-backH-20;

if(internal<30)
throw "Za ma≈Ça wysoko≈õƒá wewnƒôtrzna";

let dnoW=light-systemData[cfg.system].offset;

parts.push({name:"Front",w:cfg.width-4,h:frontH,t:18});
parts.push({name:"Ty≈Ç szuflady",w:dnoW,h:backH,t:16});
parts.push({name:"Dno szuflady",w:dnoW,h:cfg.runner,t:16});
runners.push({length:cfg.runner});
}
}

return {parts,runners};
}

/* CONFIG */

function collectConfig(){
let drawerTypes=[];
if(config.value==="Szuflady"){
for(let i=1;i<=qty.value;i++){
drawerTypes.push(document.getElementById("drawerType_"+i).value);
}
}
return{
type:type.value,
config:config.value,
frontCount:parseInt(frontCount.value),
system:system.value,
qty:parseInt(qty.value),
width:parseInt(width.value),
height:parseInt(height.value),
depth:parseInt(depth.value),
runner:parseInt(runner.value),
drawerTypes:drawerTypes
};
}

/* CALCULATE */

function calculate(){
try{
let cfg=collectConfig();
let data=generateModuleData(cfg);
let out="<h2>Wynik</h2><table><tr><th>Element</th><th>Wymiar</th></tr>";
data.parts.forEach(p=>{
out+="<tr><td>"+p.name+"</td><td>"+p.w+" x "+p.h+" x "+p.t+"</td></tr>";
});
out+="</table>";
result.innerHTML=out;
}catch(e){
result.innerHTML="<div class='warning'>"+e+"</div>";
}
}

/* MULTI */

function addModule(){
try{
let cfg=collectConfig();
generateModuleData(cfg);
project.push(cfg);
alert("Modu≈Ç dodany");
}catch(e){
alert("B≈ÇƒÖd: "+e);
}
}

function showProject(){
if(project.length===0){
projectView.innerHTML="<div class='warning'>Brak modu≈Ç√≥w</div>";
return;
}

let allParts=[];
let allRunners=[];

project.forEach(cfg=>{
let data=generateModuleData(cfg);
allParts=allParts.concat(data.parts);
allRunners=allRunners.concat(data.runners);
});

let grouped={};
allParts.forEach(p=>{
let key=p.name+"_"+p.w+"_"+p.h+"_"+p.t;
if(!grouped[key]) grouped[key]={...p,qty:0};
grouped[key].qty++;
});

let runnerGrouped={};
allRunners.forEach(r=>{
if(!runnerGrouped[r.length]) runnerGrouped[r.length]=0;
runnerGrouped[r.length]++;
});

let out="<h2>BOM ‚Äì Grupowany</h2><table><tr><th>Element</th><th>Wymiar</th><th>Ilo≈õƒá</th></tr>";

Object.values(grouped).forEach(p=>{
out+="<tr><td>"+p.name+"</td><td>"+p.w+" x "+p.h+" x "+p.t+"</td><td>"+p.qty+"</td></tr>";
});

Object.keys(runnerGrouped).forEach(len=>{
out+="<tr><td>Prowadnica "+len+" mm</td><td>-</td><td>"+runnerGrouped[len]+"</td></tr>";
});

out+="</table>";
projectView.innerHTML=out;
}

function clearProject(){
project=[];
projectView.innerHTML="";
alert("Projekt wyczyszczony");
}

autoLogic();
</script>
</body>
  </html>
